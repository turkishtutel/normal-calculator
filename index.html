<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>‚åõ Timpul este:</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<link href="https://fonts.cdnfonts.com/css/digital-7-mono" rel="stylesheet">
<style>
body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #ffffff;
    font-family: 'Fredoka One', cursive;
    margin: 0;
}
.calculator{
  background:#222;
  padding:22px;
  border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,0.25);
  display:grid;
  gap:12px;
  width:270px;
}
.display{
  width: 250px;
  background:#0b0b0b;
  color:#2bff00;
  font-size:2rem;
  text-align:right;
  padding:12px;
  border-radius:10px;
  min-height:48px;
  overflow:hidden;
  text-overflow: clip;
  white-space:nowrap;
}
.buttons {
    display: grid;
    grid-template-columns: repeat(4, 60px);
    grid-gap: 10px;
}
button {
    padding: 15px;
    font-size: 1.2em;
    border: none;
    border-radius: 10px;
    background: #444;
    color: #fff;
    cursor: pointer;
    transition: 0.2s;
}
button:hover { background: #666; }
button.operator { background: #ff9500; color: #fff; }
button.operator:hover { background: #ffa733; }
button#toggleTitle { grid-column: span 4; background: #1976d2; }
button#toggleTitle:hover { background: #2196f3; }
button#clear { grid-column: span 4; background: #d32f2f; }

#changelogBtn {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    padding: 10px 20px;
    font-size: 1em;
    border: none;
    border-radius: 10px;
    background: #1976d2;
    color: white;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transition: 0.2s;
}
#changelogBtn:hover {
    background: #2196f3;
}

.robot-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    border: none;
    border-radius: 50%;
    background: #1976d2;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    z-index: 1000;
}
.robot-btn img { width: 70%; height: 70%; }

.ai-frame {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 300px;
    height: 400px;
    background: #fff;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 999;
}
.ai-header {
    background: #1976d2;
    color: #fff;
    text-align: center;
    padding: 10px;
    font-weight: bold;
}
.ai-body {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 5px;
}
.ai-message {
    max-width: 70%;
    padding: 5px 10px;
    border-radius: 10px;
    font-size: 0.9em;
    word-wrap: break-word;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeIn 0.3s forwards;
}
.user-msg { background: #c8f7c5; align-self: flex-end; }
.ai-msg { background: #d1e7ff; align-self: flex-start; }
.timestamp { font-size: 0.7em; color: #666; margin-top: 2px; text-align: right; }

.ai-message.typing {
    display: flex;
    gap: 4px;
    width: 40px;
    padding: 5px 10px;
}
.ai-message.typing .dot {
    width: 6px;
    height: 6px;
    background: #555;
    border-radius: 50%;
    animation: blink 1.4s infinite both;
}
.ai-message.typing .dot:nth-child(2) { animation-delay: 0.2s; }
.ai-message.typing .dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes fadeIn {
    to { opacity: 1; transform: translateY(0); }
}
@keyframes blink {
    0%,80%,100% { opacity:0; }
    40% { opacity:1; }
}

.ai-textbox {
    width: 100%;
    height: 20px; 
    resize: none;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 3px 6px;
    font-size: 0.85em;
    margin-top: 5px;
}



.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999;
}

.changelog-frame {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 400px;
    height: 600px;
    background: rgba(30, 30, 30);
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    display: none;
    z-index: 2000;
    flex-direction: column;
    overflow: auto;
    padding-top: 50px; /* space for header */
}

.changelog-header {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    text-align: center;
    padding: 15px 0;
    font-size: 1.5em;
    font-weight: bold;
    color: #fff;
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    z-index: 1500;
}

.cdown {
    position: absolute;
    top: 7%;
    left: 9%;
    text-align: center;
    font-size: 50px;
    color: red;
    font-family: "Digital-7 Mono";
}

.clockdisplay {
    position: absolute;
    top: 9.8%;
    background-color: #0b0b0b;
    width: 300px;
    height: 55px;
    border-radius: 5px;
}

</style>
</head>
<body>

<button id="changelogBtn" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index:1001;">CHANGELOG V1.1</button>

<div class="modal-overlay" id="modalOverlay"></div>

<div class="changelog-frame" id="changelogFrame">
    <div class="changelog-header">CHANGELOGUL PENTRU V1.1</div>
    <div class="changelog-body">
        <p style="padding-left: 20px; color: #fff; font: fredoka-one; font-size: 30px;">‚Ä¢ Am adaugat AI Support </p>
        <p style="padding-left: 20px; color: #fff; font: fredoka-one; font-size: 30px;">‚Ä¢ Am rezolvat problema cu oprirea ceasului </p>
        <p style="padding-left: 20px; color: #fff; font: fredoka-one; font-size: 30px;">‚Ä¢ Am adaugat schimba tema </p>
        <p style="padding-left: 20px; color: #fff; font: fredoka-one; font-size: 30px;">‚Ä¢ Am rezolvat problema cu lungirea calculatorului</p>
    </div>
</div>

<button id="themeToggle" style="position: fixed; top: 20px; left: 20px; z-index:1000;">üåû</button>

<div class="calculator">
    <div class="display" id="display">0</div>
    <div class="buttons">
        <button onclick="press('7')">7</button>
        <button onclick="press('8')">8</button>
        <button onclick="press('9')">9</button>
        <button onclick="press('/')" class="operator">√∑</button>
        <button onclick="press('4')">4</button>
        <button onclick="press('5')">5</button>
        <button onclick="press('6')">6</button>
        <button onclick="press('*')" class="operator">√ó</button>
        <button onclick="press('1')">1</button>
        <button onclick="press('2')">2</button>
        <button onclick="press('3')">3</button>
        <button onclick="press('-')" class="operator">‚àí</button>
        <button onclick="press('0')">0</button>
        <button onclick="press('.')">.</button>
        <button onclick="calculate()" class="operator">=</button>
        <button onclick="press('+')" class="operator">+</button>
        <button id="clear" onclick="clearDisplay()">Clear</button>
        <button id="toggleTitle" onclick="toggleTitle()">üê±‚Äçüë§</button>
    </div>
</div>

<div class="clockdisplay">
    <div class="cdown">0:000:000</div>
</div>
    
<button class="robot-btn" onclick="toggleAIFrame()">
    <img src="https://cdn-icons-png.flaticon.com/512/4712/4712015.png" alt="Robot">
</button>

<div class="ai-frame" id="aiFrame">
    <div class="ai-header">AI SUPPORT</div>
    <div class="ai-body" id="aiBody"></div>
    <textarea class="ai-textbox" id="aiInput" placeholder="Type your message..."></textarea>
</div>

<script>
let expression = '';
let showTime = true;
let darkMode = false;

const changelogBtn = document.getElementById('changelogBtn');
const changelogFrame = document.getElementById('changelogFrame');
const modalOverlay = document.getElementById('modalOverlay');

changelogBtn.addEventListener('click', () => {
    const isOpen = changelogFrame.style.display === 'flex';
    changelogFrame.style.display = isOpen ? 'none' : 'flex';
    modalOverlay.style.display = isOpen ? 'none' : 'block';
});

modalOverlay.addEventListener('click', () => {
    changelogFrame.style.display = 'none';
    modalOverlay.style.display = 'none';
});

function toggleTheme() {
    darkMode = !darkMode;
    const body = document.body;
    if(darkMode){
        body.style.background = '#2e2e2e';
        document.getElementById('themeToggle').textContent = 'üåô';
    } else {
        body.style.background = '#ffffff';
        document.getElementById('themeToggle').textContent = 'üåû';
    }
}
document.getElementById('themeToggle').addEventListener('click', toggleTheme);

function calculate() {
    try {
        let sanitized = expression
            .replace(/\/+/g, '/')
            .replace(/\*+/g, '*')
            .replace(/\++/g, '+')
            .replace(/-+/g, '-');
        expression = eval(sanitized).toString().slice(0, 15);
    } catch {
        expression = 'Error';
    }
    document.getElementById('display').textContent = expression;
}

function press(value) {
    expression += value;
    document.getElementById('display').textContent = expression;
}

function clearDisplay() {
    expression = '';
    document.getElementById('display').textContent = '0';
}

// NEW clock (self-correcting)
function updateClock() {
    const now = new Date();
    let hours = now.getHours();
    const minutes = now.getMinutes().toString().padStart(2,'0');
    const seconds = now.getSeconds().toString().padStart(2,'0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12;
    if(showTime) {
        document.title = `‚åõ Timpul este: ${hours}:${minutes}:${seconds}${ampm}`;
    }
}
function tickClock() {
    updateClock();
    const now = new Date();
    const delay = 1000 - now.getMilliseconds();
    setTimeout(tickClock, delay);
}
tickClock();

let lastTitle = document.title;
let lastUpdate = Date.now();

setInterval(() => {
  if (document.title !== lastTitle) {
    lastTitle = document.title;
    lastUpdate = Date.now();
  }
  // if title hasn't changed in 10 seconds, reload
  if (Date.now() - lastUpdate > 5000) {
    location.reload();
  }
}, 2000);
    
function toggleTitle() {
    showTime = !showTime;
    if(!showTime) document.title = "Calc";
}

function toggleAIFrame() {
    const frame = document.getElementById('aiFrame');
    frame.style.display = frame.style.display === 'flex' ? 'none' : 'flex';
}

// Chat
const aiInput = document.getElementById('aiInput');
const aiBody = document.getElementById('aiBody');
const conversation = [
    { role: 'system', content: 'You are a chatbot that speaks Romanian only. Do NOT use any formatting like code blocks, math symbols, lists, bold, italics, or tables. Just write simple text sentences.' }
];

function addMessage(text, type) {
    const msg = document.createElement('div');
    msg.className = `ai-message ${type}`;
    const timestamp = document.createElement('div');
    timestamp.className = 'timestamp';
    const now = new Date();
    timestamp.textContent = now.getHours().toString().padStart(2,'0')+':' +
                            now.getMinutes().toString().padStart(2,'0');
    msg.textContent = text;
    msg.appendChild(timestamp);
    aiBody.appendChild(msg);
    aiBody.scrollTop = aiBody.scrollHeight;
}

aiInput.addEventListener('keydown', async function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        const text = aiInput.value.trim();
        if (!text) return;

        addMessage(text, 'user-msg');
        aiInput.value = '';
        aiInput.disabled = true;
        conversation.push({ role: 'user', content: text });

        const typingMsg = document.createElement('div');
        typingMsg.className = 'ai-message ai-msg typing';
        typingMsg.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
        aiBody.appendChild(typingMsg);
        aiBody.scrollTop = aiBody.scrollHeight;

        try {
            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    Authorization: 'Bearer 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',
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'openai/gpt-oss-20b:free',
                    messages: conversation
                }),
            });
            const data = await response.json();
            console.log(data);
            const reply = data.choices?.[0]?.message?.content 
                || data.error?.message 
                || "No response";
            conversation.push({ role: 'assistant', content: reply });
            typingMsg.remove();
            addMessage(reply, 'ai-msg');
        } catch(err) {
            typingMsg.remove();
            addMessage("Error: " + err.message, 'ai-msg');
        } finally {
            aiInput.disabled = false;
            aiInput.focus();
        }
    }
});

function updcdown() {
    const target = new Date(2025, 11, 1, 0, 0, 0); // month 11 = December (0-based)
    const now = new Date();
    const diff = target - now;

    if (diff <= 0) {
        document.querySelector(".cdown").textContent = "00:00:00:00";
        return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const mins = Math.floor((diff / (1000 * 60)) % 60);
    const secs = Math.floor((diff / 1000) % 60);

    document.querySelector(".cdown").textContent =
        `${days}:${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

setInterval(updcdown, 1000);
updcdown();
</script>
</body>
</html>
